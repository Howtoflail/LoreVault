# LoreVault

## Description
The **User Service** handles all requests for user CRUD. It also logs in existing users by validating the token retrieved after logging in with Google from the frontend. Written in **ASP NET Core**, it leverages authentication and authorization checks with access tokens generated by Auth0.

## Purpose
The purpose of the user service is to handle CRUD operations for users in the LoreVault application.

## Endpoints
all endpoints will follow the structure /api/User/ENDPOINT_NAME

### GET `/get-users`

#### Returns
Json body that includes all the users of the application.

---

### GET `/get-user-by-id-private?id=STRING`

#### Parameters
- `[query] id` specifies the id of the user to be retrieved. 

#### Headers
`Authorization: Bearer TOKEN`, where `TOKEN` is the access token from auth0 must be present.

#### Returns
Json body that includes the user of the application.

---

### POST `/login-with-google`

#### Parameters
- `[query] id` specifies the id of the user to be retrieved. 

#### Headers
`Content-Type: application/json`, where the body needs to contain the id token retrieved after logging in with Google through Auth0 and being redirected to the home page.

#### Returns
The method validates the token sent in the body, after which makes a query to check if the user is already a user of LoreVault. If not, a new user is created. If the user already exists, it logs the user in.
A JWT Token that is stored in the session in the frontend and used as an access token in the document service.

### Running locally
Follow these steps to set up the User Service.

#### 1. Clone the Repository
Start by cloning the project repository to your local machine:
```bash
git clone https://git.fhict.nl/I516586/lorevault.git
```

#### 2. Set up environment variables
Set up the environment variables to be able to connect to the database by creating a appsettings.json file based on the `example.appsettings.json`. To do that, make sure to be inside the `ROOT\LoreVault\LoreVault.API` directory, and then run:
```bash
cp example.appsettings.json appsettings.json
```

#### 3. Build the Docker image and run the container
After setting up the environment variables in the `appsettings.json` file, make sure to be inside `ROOT\LoreVault` directory, and then run:
```bash
docker build -t lorevault-api .
docker run -d -p 8080:8080 lorevault-api
```